// get_themoviedb.js

const fetch = require('node-fetch');

const headers = {
  method: 'GET',
  headers: {
    accept: 'application/json',
    Authorization: `Bearer ${process.env.THEMOVIEDB_APIKEY}`
  }
};

const genres = {
 "movies": [{ "id": 28, "name": "Action" }, { "id": 12, "name": "Adventure" }, { "id": 16, "name": "Animation" }, { "id": 35, "name": "Comedy" }, { "id": 80, "name": "Crime" }, { "id": 99, "name": "Documentary" }, { "id": 18, "name": "Drama" }, { "id": 10751, "name": "Family" }, { "id": 14, "name": "Fantasy" }, { "id": 36, "name": "History" }, { "id": 27, "name": "Horror" }, { "id": 10402, "name": "Music" }, { "id": 9648, "name": "Mystery" }, { "id": 10749, "name": "Romance" }, { "id": 878, "name": "Science Fiction" }, { "id": 10770, "name": "TV Movie" }, { "id": 53, "name": "Thriller" }, { "id": 10752, "name": "War" }, { "id": 37, "name": "Western" }],
 "tv": [{ "id": 10759, "name": "Action & Adventure" }, { "id": 16, "name": "Animation" }, { "id": 35, "name": "Comedy" }, { "id": 80, "name": "Crime" }, { "id": 99, "name": "Documentary" }, { "id": 18, "name": "Drama" }, { "id": 10751, "name": "Family" }, { "id": 10762, "name": "Kids" }, { "id": 9648, "name": "Mystery" }, { "id": 10763, "name": "News" }, { "id": 10764, "name": "Reality" }, { "id": 10765, "name": "Sci-Fi & Fantasy" }, { "id": 10766, "name": "Soap" }, { "id": 10767, "name": "Talk" }, { "id": 10768, "name": "War & Politics" }, { "id": 37, "name": "Western" }];
};

async function fetchData(url, options) {
  try {
    const response = await fetch(url, options);
    return json = await response.json();
  }
  catch (error) { console.error('Error:', error); throw new Error(`Debug: ${error}`); }
}

async function getMediaID() { // returns id of first result
  try {
    const url = `https://api.themoviedb.org/3/${infoType}/${mediaType}?include_adult=false&language=en-US&page=1&query=${query}&primary_release_year=${year}`;
    const response = fetchData(url, options);
    const id = response.results[0].id;
    console.log(`id = ${id} for mediaType ${mediaType}`);
    return result;
  }
  catch (error) { console.error('Error:', error); throw new Error(`Debug: ${error}`); }
}

const get_themoviedb = async ({ mediaType, infoType, query, year, season, episode }) => {
  try {
    console.log("get_themoviedb function was called");
    console.log(`calling mediaType = ${mediaType}, infoType = ${infoType}, query = ${query}`);

    const mediaID = getMediaID(mediaType,infoType,query,year); // needed for certain future prompts

    // build logic to construct url
    // search: movie, tv, person // demo url https://api.themoviedb.org/3/search/movie?include_adult=false&language=en-US&page=1
    // trending: movie, tv, people // demo url https://api.themoviedb.org/3/trending/all/week?language=en-US
    // movie lists: now_playing, popular, top_rated, upcoming // demo url https://api.themoviedb.org/3/movie/now_playing?language=en-US&page=1
    // tv series lists: popular, top_rated // demo url https://api.themoviedb.org/3/tv/popular?language=en-US&page=1

    // the following are mediaID dependant
    // tv series details: // demo url https://api.themoviedb.org/3/tv/${mediaID}?language=en-US
    // tv season details: // demo url https://api.themoviedb.org/3/tv/${mediaID}/season/${season}?language=en-US
    // tv episode details: // demo url https://api.themoviedb.org/3/tv/${mediaID}/season/${season}/episode/${episode}?language=en-US



    return await fetchData(url, options);
  }
  catch (error) { console.error('Error:', error); throw new Error(`Debug: ${error}`); }
}

module.exports = { get_themoviedb };

/*
{
  "name": "get_themoviedb",
  "parameters": {
    "type": "object",
    "properties": {
      "mediaType": {
        "type": "string",
        "enum": [
          "movie",
          "tv",
          "multi",
          "actor"
        ],
        "description": "The type of media inquiry in question."
      },
      "infoType": {
        "type": "string",
        "enum": [
          "search",
          "nowPlaying",
          "popular",
          "topRated",
          "upcoming",
          "onTheAir"
        ],
        "description": "The type of information about the media in question."
      },
      "query": {
        "type": "string",
        "description": "The search query related to the mediaType in question. For example: the name of the actor, movie, or show."
      },
      "year": {
        "type": "string",
        "description:": "If applicable, the year of release of the media in question. Required if a request is targeting a specific movie or show."
      }
    },
    "required": [
      "mediaType",
      "infoType",
      "query"
    ]
  },
  "description": "This function connects to the The Movie Database API to fetch information about movies and TV shows."
}
*/